# ZMK Studio 関連
CONFIG_ZMK_STUDIO=n
CONFIG_ZMK_STUDIO_LOCKING=n

# 送信出力
# --- TX power: +8 → +4 ---
# CONFIG_BT_CTLR_TX_PWR_PLUS_8 is not set
CONFIG_BT_CTLR_TX_PWR_PLUS_4=y

# バッテリー情報を central 側でまとめて扱う設定
CONFIG_ZMK_SPLIT_BLE_CENTRAL_BATTERY_LEVEL_PROXY=y
CONFIG_ZMK_SPLIT_BLE_CENTRAL_BATTERY_LEVEL_FETCHING=y

# USB 経由ブートローダ起動
CONFIG_ZMK_CDC_ACM_BOOTLOADER_TRIGGER=n

# ステータス LED
CONFIG_ZMK_STATUS_LED=y

# スリープ関連（既存）
CONFIG_ZMK_IDLE_SLEEP_TIMEOUT=9000000

# Ni-MH / 単三用の電圧閾値
CONFIG_ZMK_NON_LIPO_MIN_MV=1000
CONFIG_ZMK_NON_LIPO_LOW_MV=900

# ===== ここから BLE 低遅延モードの追加 =====

# 接続間隔 12 * 1.25ms = 約 15ms
# 15ms固定 → 15〜30ms くらいの範囲に（中央が選びやすい）
CONFIG_BT_PERIPHERAL_PREF_MIN_INT=24
CONFIG_BT_PERIPHERAL_PREF_MAX_INT=36

# パケット送信 → 少しだけサボる（負荷耐性UP）0→4（4〜15で調整）
CONFIG_BT_PERIPHERAL_PREF_LATENCY=10

# タイムアウト（切断判定までの時間）
CONFIG_BT_PERIPHERAL_PREF_TIMEOUT=400

# ===== BLE split（左↔右） 以下はcentral側のみに記述する。 =====
# CONFIG_ZMK_SPLIT_BLE_PREF_INT=12
# CONFIG_ZMK_SPLIT_BLE_PREF_LATENCY=30
# CONFIG_ZMK_SPLIT_BLE_PREF_TIMEOUT=400

# ---- Pointing（右側に入れると右側が反応しなくなるため、削除）----
# CONFIG_ZMK_POINTING=y
# CONFIG_ZMK_POINTING_SMOOTH_SCROLLING=y

# ===== その他　=====

# 長いマクロ対策（まずは 256、ダメなら 512）
CONFIG_ZMK_BEHAVIORS_QUEUE_SIZE=256

# ビルドエラー対策
CONFIG_RETENTION=n
CONFIG_RETAINED_MEM=n
CONFIG_RETAINED_MEM_ZEPHYR_RAM=n
CONFIG_RETENTION_BOOT_MODE=n

# 左右 両方
CONFIG_ZMK_KSCAN_DEBOUNCE_PRESS_MS=10
CONFIG_ZMK_KSCAN_DEBOUNCE_RELEASE_MS=10

# BLEの送受信バッファ増量（フリーズ対策の定番）
CONFIG_BT_BUF_ACL_RX_COUNT=30
CONFIG_BT_BUF_ACL_TX_COUNT=30
CONFIG_BT_BUF_EVT_RX_COUNT=30

# --- TX詰まり対策（送信キュー増量） ---
CONFIG_BT_L2CAP_TX_BUF_COUNT=30
CONFIG_BT_CONN_TX_MAX=30

# スタック不足対策（フリーズ対策）
CONFIG_MAIN_STACK_SIZE=4096
CONFIG_BT_RX_STACK_SIZE=4096
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=4096
# CONFIG_ZMK_EVENT_MANAGER_THREAD_STACK_SIZE=4096 は環境にないため、コメントアウト

# 一時的ログ取り用
CONFIG_LOG=n
# CONFIG_LOG_DEFAULT_LEVEL=3